<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulación con Costos y Riesgos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background: #020617;
            min-height: 100vh;
        }

        .glass-effect {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 116, 139, 0.2);
        }

        .card {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(100, 116, 139, 0.3);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .metric-card {
            background: linear-gradient(145deg, #1e293b, #0f172a);
            border: 1px solid rgba(100, 116, 139, 0.3);
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
            border-color: rgba(147, 197, 253, 0.4);
        }

        #proceso span,
        #riesgosDiarios span {
            display: block;
            animation: aparecer 0.5s ease-in;
            padding: 8px 12px;
            margin: 4px 0;
            border-radius: 8px;
            background: rgba(59, 130, 246, 0.15);
            border-left: 4px solid #3b82f6;
            color: #e2e8f0;
        }

        #riesgosDiarios span {
            background: rgba(251, 191, 36, 0.15);
            border-left-color: #fbbf24;
        }

        @keyframes aparecer {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            transition: all 0.3s ease;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(239, 68, 68, 0.4);
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-ok {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .status-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .status-shipping {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }

        .table-container {
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
        }

        .table-header {
            background: linear-gradient(135deg, #0f172a, #020617);
            color: #e2e8f0;
        }

        .table-row:nth-child(even) {
            background: rgba(30, 41, 59, 0.3);
        }

        .table-row:hover {
            background: rgba(59, 130, 246, 0.15);
            transform: scale(1.01);
            transition: all 0.2s ease;
        }

        .floating-header {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(100, 116, 139, 0.3);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .speed-slider {
            background: linear-gradient(90deg, #3b82f6, #6366f1);
            border-radius: 10px;
            height: 8px;
            outline: none;

        }

        .speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #e2e8f0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            cursor: pointer;
        }

        .mobile-card {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(100, 116, 139, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin: 8px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        @media (max-width: 768px) {
            .desktop-table {
                display: none;
            }

            .mobile-cards {
                display: block;
            }
        }

        @media (min-width: 769px) {
            .desktop-table {
                display: block;
            }

            .mobile-cards {
                display: none;
            }
        }

        .pulse-animation {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        /* Dark mode specific adjustments */
        .dark-input {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(100, 116, 139, 0.4);
            color: #e2e8f0;
        }

        .dark-input:focus {
            border-color: #3b82f6;
            outline: none;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }

        .category-summary {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
            border: 1px solid rgba(100, 116, 139, 0.3);
        }

        .category-summary:hover {
            border-color: rgba(147, 197, 253, 0.4);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
        }

        .fade-out {
            opacity: 0;
            transition: opacity 1s ease-out;
            pointer-events: none;
        }

        .progress-bar {
            animation: fillBar 6s linear forwards;
        }

        @keyframes fillBar {
            from {
                width: 0%;
            }

            to {
                width: 100%;
            }
        }
    </style>
</head>

<body class="text-slate-100 bg-slate-950">
    <div id="preloader"
        class="fixed inset-0 flex flex-col items-center justify-center text-center text-white z-50 bg-slate-950 px-4">
        <img src="./img/logofiltros.png" alt="Logo" class="w-auto h-54  md:w-38 md:h-60">
        <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold mb-2">Bienvenido</h1>
        <h2 class="text-lg sm:text-xl md:text-2xl text-cyan-400 font-semibold mb-1">Carrera Ingenieria de Sistemas</h2>
        <p class="text-sm sm:text-base md:text-lg max-w-md mb-6">Materia Simulacion de sistemas I</p>

        <!-- Barra de carga -->
        <div class="w-full max-w-xs h-2 bg-white/20 rounded overflow-hidden">
            <div class="h-full bg-cyan-400 progress-bar"></div>
        </div>
    </div>
    <!-- Header flotante -->
    <div id="contenido" class="hidden floating-header p-4 sm:p-6">
        <div class="max-w-7xl mx-auto">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                <h1
                    class="text-2xl sm:text-3xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent">
                    <i class="fas fa-boxes mr-2"></i>Simulación de Inventario
                </h1>
                <div class="flex items-center gap-4">
                    <div class="bg-slate-800 border border-slate-600 px-4 py-2 rounded-full shadow-lg">
                        <span class="font-semibold text-slate-200">
                            <i class="fas fa-calendar-day mr-2 text-blue-400"></i>Día:
                            <span id="diaActual" class="text-blue-400 font-bold">0</span>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto p-4 sm:p-6 pt-24">
        <!-- Controles principales -->
        <div class="card rounded-2xl p-6 mb-6">
            <div class="flex flex-col sm:flex-row items-center gap-4">
                <button onclick="generarEscenario()"
                    class="btn-primary text-white px-6 py-3 rounded-xl font-semibold flex items-center gap-2 w-full sm:w-auto">
                    <i class="fas fa-dice"></i>
                    Generar Escenario
                </button>
                <button onclick="reiniciarDatos()"
                    class="btn-danger text-white px-6 py-3 rounded-xl font-semibold flex items-center gap-2 w-full sm:w-auto">
                    <i class="fas fa-redo"></i>
                    Reiniciar
                </button>

                <!-- Control de velocidad -->
                <div class="flex-1 w-full sm:w-auto">
                    <label class="block font-semibold mb-2 text-slate-200">
                        <i class="fas fa-tachometer-alt mr-2 text-cyan-400"></i>
                        Velocidad: <span id="velocidadTexto" class="text-cyan-400 font-bold">12</span>s por día
                    </label>
                    <input type="range" id="rangeVelocidad" min="1" max="20" value="12" step="1"
                        class="w-full speed-slider" oninput="cambiarVelocidad(this.value)">
                </div>
            </div>
        </div>

        <!-- Panel financiero -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div class="metric-card rounded-2xl p-4 sm:p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-sm font-medium text-slate-400 uppercase tracking-wide">Capital Inicial</h3>
                        <div id="capitalInicial" class="text-xl sm:text-2xl font-bold text-emerald-400 mt-1">Bs 100.00
                        </div>
                    </div>
                    <div class="p-3 bg-emerald-500/20 rounded-full">
                        <i class="fas fa-piggy-bank text-emerald-400 text-xl"></i>
                    </div>
                </div>
            </div>

            <div class="metric-card rounded-2xl p-4 sm:p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-sm font-medium text-slate-400 uppercase tracking-wide">Gastos</h3>
                        <div id="gastosTotales" class="text-xl sm:text-2xl font-bold text-red-400 mt-1">Bs 0.00</div>
                    </div>
                    <div class="p-3 bg-red-500/20 rounded-full">
                        <i class="fas fa-arrow-down text-red-400 text-xl"></i>
                    </div>
                </div>
            </div>

            <div class="metric-card rounded-2xl p-4 sm:p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-sm font-medium text-slate-400 uppercase tracking-wide">Ingresos</h3>
                        <div id="ingresosTotales" class="text-xl sm:text-2xl font-bold text-emerald-400 mt-1">Bs 0.00
                        </div>
                    </div>
                    <div class="p-3 bg-emerald-500/20 rounded-full">
                        <i class="fas fa-arrow-up text-emerald-400 text-xl"></i>
                    </div>
                </div>
            </div>

            <div class="metric-card rounded-2xl p-4 sm:p-6 col-span-1 lg:col-span-1">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-sm font-medium text-slate-400 uppercase tracking-wide">Capital Actual</h3>
                        <div id="capitalActual" class="text-xl sm:text-2xl font-bold text-blue-400 mt-1">Bs 100.00
                        </div>
                    </div>
                    <div class="p-3 bg-blue-500/20 rounded-full">
                        <i class="fas fa-wallet text-blue-400 text-xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Estadísticas de ventas -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div class="card rounded-2xl p-6">
                <h2 class="text-lg font-semibold mb-4 flex items-center text-slate-100">
                    <i class="fas fa-trophy text-yellow-400 mr-2"></i>
                    Producto Más Vendido
                </h2>
                <div id="masVendido"
                    class="text-emerald-300 font-semibold bg-emerald-500/10 border border-emerald-500/20 p-3 rounded-lg">
                    —</div>
            </div>

            <div class="card rounded-2xl p-6">
                <h2 class="text-lg font-semibold mb-4 flex items-center text-slate-100">
                    <i class="fas fa-chart-line-down text-red-400 mr-2"></i>
                    Producto Menos Vendido
                </h2>
                <div id="menosVendido"
                    class="text-red-300 font-semibold bg-red-500/10 border border-red-500/20 p-3 rounded-lg">—</div>
            </div>
        </div>

        <!-- Resumen por categorías -->
        <div class="card rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4 flex items-center text-slate-100">
                <i class="fas fa-chart-pie text-cyan-400 mr-2"></i>
                Resumen por Categoría
            </h2>
            <div id="resumenCategorias" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"></div>
        </div>

        <!-- Tabla de inventario - Desktop -->
        <div class="card rounded-2xl p-6 mb-6 desktop-table">
            <h2 class="text-xl font-semibold mb-4 flex items-center text-slate-100">
                <i class="fas fa-inventory text-blue-400 mr-2"></i>
                Inventario de Productos
            </h2>
            <div class="table-container overflow-x-auto">
                <table class="w-full text-sm min-w-[1500px] table-auto">
                    <thead class="table-header">
                        <tr>
                            <th class="px-4 py-3 text-left">Producto</th>
                            <th class="px-4 py-3 text-center">Stock</th>
                            <th class="px-4 py-3 text-center">Stock Mín</th>
                            <th class="px-4 py-3 text-center">Consumo/Día</th>
                            <th class="px-4 py-3 text-center">Compra</th>
                            <th class="px-4 py-3 text-center">Transporte</th>
                            <th class="px-4 py-3 text-center">Total</th>
                            <th class="px-4 py-3 text-center">Venta</th>
                            <th class="px-4 py-3 text-center">Entrega</th>
                            <th class=" campo px-4 py-3 text-center">Estado</th>
                            <th class="px-4 py-3 text-center">Recom.</th>
                            <th class="px-4 py-3 text-center">Pedido</th>
                            <th class="px-4 py-3 text-center">Acción</th>
                            <th class="px-4 py-3 text-center">Venta</th>
                        </tr>
                    </thead>
                    <tbody id="tablaProductos"></tbody>
                </table>
            </div>
        </div>

        <!-- Cards móviles -->
        <div class="mobile-cards">
            <h2 class="text-xl font-semibold mb-4 flex items-center text-slate-100">
                <i class="fas fa-inventory text-blue-400 mr-2"></i>
                Inventario de Productos
            </h2>
            <div id="mobileProductos"></div>
        </div>

        <!-- Logs de proceso y riesgos -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="card rounded-2xl p-6">
                <h2 class="text-xl font-semibold mb-4 flex items-center text-slate-100">
                    <i class="fas fa-brain text-emerald-400 mr-2"></i>
                    Proceso de Simulación
                </h2>
                <div id="proceso"
                    class="space-y-2 text-sm h-60 overflow-y-auto border border-slate-600 rounded-xl p-4 bg-gradient-to-br from-slate-800/50 to-slate-900/50">
                </div>
            </div>

            <div class="card rounded-2xl p-6">
                <h2 class="text-xl font-semibold mb-4 flex items-center text-slate-100">
                    <i class="fas fa-exclamation-triangle text-yellow-400 mr-2"></i>
                    Riesgos y Eventos
                </h2>
                <div id="riesgosDiarios"
                    class="space-y-2 text-sm h-60 overflow-y-auto border border-slate-600 rounded-xl p-4 bg-gradient-to-br from-yellow-900/30 to-orange-900/30">
                </div>
            </div>
        </div>
    </div>

    <script>
        setTimeout(() => {
            const preloader = document.getElementById('preloader');
            preloader.classList.add('fade-out');
            setTimeout(() => {
                preloader.style.display = 'none';
                document.getElementById('contenido').classList.remove('hidden');
            }, 1000);
        }, 6000);
    </script>
    <script>
        let productos = [], diaActual = 0, intervalo = null, intervaloDuracion = 12000;
        let capitalInicial = 10000, ingresos = 0, gastos = 0;

        const proceso = document.getElementById("proceso");
        const riesgosDiv = document.getElementById("riesgosDiarios");
        const tablaBody = document.getElementById("tablaProductos");
        const mobileContainer = document.getElementById("mobileProductos");

        const nombres = ["Leche", "Queso", "Yogurt", "Carne", "Galletas",
            "Chocolate", "Salchichas", "Pan", "Jamón", "Aceite"
        ];

        const categorias = {
            "Lácteos": ["Leche", "Queso", "Yogurt"],
            "Panadería": ["Pan", "Galletas"],
            "Carnes": ["Carne", "Jamón", "Salchichas"],
            "Dulces": ["Chocolate"],

            "Aceites": ["Aceite"]
        };

        const iconosCategoria = {
            "Lácteos": "fas fa-cheese",


            "Panadería": "fas fa-bread-slice",
            "Carnes": "fas fa-drumstick-bite",
            "Dulces": "fas fa-candy-cane",

            "Aceites": "fas fa-oil-can"
        };

        const riesgos = [
            { emoji: "🌧️", efecto: "lluvia", costo: 1.1 },
            { emoji: "🚧", efecto: "bloqueo", demora: 1 },
            { emoji: "⛽", efecto: "escasez", costo: 1.2 },
            null
        ];

        function obtenerCategoria(nombre) {
            for (const [cat, items] of Object.entries(categorias))
                if (items.includes(nombre)) return cat;
            return "Otros";
        }

        function generarProducto(i) {
            const nombre = nombres[i];
            return {
                id: i, nombre,
                categoria: obtenerCategoria(nombre),
                cantidad: Math.floor(Math.random() * 50) + 20,
                stockMin: Math.floor(Math.random() * 20) + 10,
                tiempoEntrega: Math.floor(Math.random() * 5) + 1,
                consumoEstimadoPorDia: Math.floor(Math.random() * 3) + 2,
                costoCompra: +(Math.random() * 10 + 5).toFixed(2),
                costoTransporte: +(Math.random() * 3 + 1).toFixed(2),
                pedidoCantidad: 0, entregaEnDias: 0,
                estado: "OK", ventasTotales: 0
            };
        }

        function generarEscenario() {
            productos = []; diaActual = 0; clearInterval(intervalo);
            proceso.innerHTML = ""; riesgosDiv.innerHTML = "";
            document.getElementById("rangeVelocidad").value = 12;
            document.getElementById("velocidadTexto").textContent = "12";
            capitalInicial = 100; ingresos = 0; gastos = 0; actualizarFinanzas();
            for (let i = 0; i < nombres.length; i++) productos.push(generarProducto(i));
            actualizarTabla(); actualizarMasYMenosVendidos(); actualizarResumenCategorias();
            iniciarSimulacion();
        }

        function actualizarTabla() {
            tablaBody.innerHTML = ""; mobileContainer.innerHTML = "";
            productos.forEach(p => {
                // Estado y cálculos
                p.estado = p.entregaEnDias > 0
                    ? `🚚llega en (${p.entregaEnDias}D)`
                    : p.cantidad < p.stockMin
                        ? "⚠️ ¡Pedir!"
                        : "✅ OK";
                const totalCost = +(p.costoCompra + p.costoTransporte).toFixed(2);
                const precioVenta = +(totalCost * 1.2).toFixed(2);
                const cantRec = Math.ceil(p.stockMin + p.consumoEstimadoPorDia * p.tiempoEntrega - p.cantidad);

                // Badge
                let estadoBadge;
                if (p.estado.includes("⚠️")) {
                    estadoBadge = `<span class="status-badge status-warning">${p.estado}</span>`;
                } else if (p.estado.includes("🚚")) {
                    estadoBadge = `<span class="status-badge status-shipping">${p.estado}</span>`;
                } else {
                    estadoBadge = `<span class="status-badge status-ok">${p.estado}</span>`;
                }

                // Fila escritorio
                const tr = document.createElement("tr");
                tr.className = "table-row";
                tr.innerHTML = `
                <td class="px-4 py-3">
                    <div class="flex items-center">
                        <i class="${iconosCategoria[p.categoria] || 'fas fa-box'} text-blue-500 mr-2"></i>
                        <div>
                            <div class="font-semibold">${p.nombre}</div>
                            <div class="text-xs text-gray-500">${p.categoria}</div>
                        </div>
                    </div>
                </td>
                <td class="px-4 py-3 text-center font-bold ${p.cantidad < p.stockMin ? 'text-red-600' : 'text-green-600'}">${p.cantidad}</td>
                <td class="px-4 py-3 text-center text-gray-600">${p.stockMin}</td>
                <td class="px-4 py-3 text-center text-purple-600">${p.consumoEstimadoPorDia}</td>
                <td class="px-4 py-3 text-center text-yellow-300">${p.costoCompra.toFixed(2)} bs</td>
                <td class="px-4 py-3 text-center text-gray-400">${p.costoTransporte.toFixed(2)} bs</td>
                <td class="px-4 py-3 text-center font-bold text-gray-700">${totalCost} bs</td>
                <td class="px-4 py-3 text-center font-bold text-green-500">${precioVenta} bs</td>
                <td class="px-4 py-3 text-center text-blue-600">${p.tiempoEntrega}-dias</td>
                <td class="px-4 py-3 text-center">${estadoBadge}</td>
                <td class="px-4 py-3 text-center">${p.estado.includes('⚠️') ? `<span class="text-blue-600 font-bold">💡 ${cantRec}</span>` : '—'}</td>
                <td class="px-4 py-3 text-center">${p.estado.includes('⚠️') ? `<input type="number" id="input-${p.id}" min="1" placeholder="0" class="w-16 px-2 py-1 text-slate-950 border rounded-lg text-center">` : '—'}</td>
                <td class="px-4 py-3 text-center">${p.estado.includes('⚠️') ? `<button onclick="hacerPedido(${p.id})" class="bg-yellow-500 hover:bg-yellow-600 text-white text-xs px-3 py-1 rounded-full transition-all duration-200 hover:scale-105"><i class="fas fa-shopping-cart mr-1"></i>Pedir</button>` : '—'}</td>
                <td class="px-4 py-3 text-center">${p.cantidad > 0 ? `<button onclick="ventaManual(${p.id})" class="bg-green-600 hover:bg-green-700 text-white text-xs px-3 py-1 rounded-full transition-all duration-200 hover:scale-105"><i class="fas fa-cash-register mr-1"></i>Vender</button>` : `<span class="text-gray-400">Sin stock</span>`}</td>
            `;
                tablaBody.appendChild(tr);

                // Card móvil
                const card = document.createElement("div");
                card.className = "mobile-card";
                card.innerHTML = `
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center">
                        <i class="${iconosCategoria[p.categoria] || 'fas fa-box'} text-blue-500 mr-2 text-lg"></i>
                        <div>
                            <h3 class="font-bold text-lg">${p.nombre}</h3>
                            <span class="text-sm text-gray-500">${p.categoria}</span>
                        </div>
                    </div>
                    ${estadoBadge}
                </div>
                <div class="grid grid-cols-2 gap-4 mb-3">
                    <div class="bg-gray-50 p-2 rounded-lg">
                        <div class="text-xs text-gray-500">Stock Actual</div>
                        <div class="font-bold ${p.cantidad < p.stockMin ? 'text-red-600' : 'text-green-600'}">${p.cantidad}</div>
                    </div>
                    <div class="bg-gray-50 p-2 rounded-lg">
                        <div class="text-xs text-gray-500">Stock Mínimo</div>
                        <div class="font-bold text-gray-700">${p.stockMin}</div>
                    </div>
                    <div class="bg-gray-50 p-2 rounded-lg">
                        <div class="text-xs text-gray-500">Precio Venta</div>
                        <div class="font-bold text-green-600">$${precioVenta}</div>
                    </div>
                    <div class="bg-gray-50 p-2 rounded-lg">
                        <div class="text-xs text-gray-500">Entrega</div>
                        <div class="font-bold text-blue-600">${p.tiempoEntrega}d</div>
                    </div>
                </div>
                <div class="flex gap-2">
                    ${p.estado.includes('⚠️') ? `
                        <div class="flex-1">
                            <input type="number" id="input-mobile-${p.id}" min="1" placeholder="Cantidad" class="w-full px-3 py-2 border rounded-lg text-center">
                        </div>
                        <button onclick="hacerPedidoMobile(${p.id})" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg">
                            <i class="fas fa-shopping-cart"></i>
                        </button>
                    `: ""}
                    ${p.cantidad > 0 ? `
                        <button onclick="ventaManual(${p.id})" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex-1">
                            <i class="fas fa-cash-register mr-1"></i>Vender 1
                        </button>
                    `: `<div class="bg-gray-200 text-gray-500 px-4 py-2 rounded-lg flex-1 text-center">Sin stock</div>`}
                </div>
            `;
                mobileContainer.appendChild(card);
            });
        }

        function actualizarMasYMenosVendidos() {
            if (!productos.length) return;
            let mas = productos[0], menos = productos[0];
            productos.forEach(p => {
                if (p.ventasTotales > mas.ventasTotales) mas = p;
                if (p.ventasTotales < menos.ventasTotales) menos = p;
            });
            document.getElementById("masVendido").innerHTML = `
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <i class="${iconosCategoria[mas.categoria] || 'fas fa-box'} text-yellow-500 mr-2"></i>
                    <span class="font-bold">${mas.nombre}</span>
                </div>
                <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-bold">
                    ${mas.ventasTotales} vendidas
                </span>
            </div>`;
            document.getElementById("menosVendido").innerHTML = `
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <i class="${iconosCategoria[menos.categoria] || 'fas fa-box'} text-red-500 mr-2"></i>
                    <span class="font-bold">${menos.nombre}</span>
                </div>
                <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-bold">
                    ${menos.ventasTotales} vendidas
                </span>
            </div>`;
        }

        function actualizarResumenCategorias() {
            const resumen = {};
            productos.forEach(p => {
                if (!resumen[p.categoria]) resumen[p.categoria] = { cnt: 0, vend: 0, stock: 0 };
                resumen[p.categoria].cnt++;
                resumen[p.categoria].vend += p.ventasTotales;
                resumen[p.categoria].stock += p.cantidad;
            });
            const cont = document.getElementById("resumenCategorias");
            cont.innerHTML = "";
            Object.entries(resumen).forEach(([cat, d]) => {
                const avg = (d.stock / d.cnt).toFixed(1);
                const card = document.createElement("div");
                card.className = "category-summary rounded-xl p-4";
                card.innerHTML = `
                <div class="flex items-center mb-2">
                    <i class="${iconosCategoria[cat] || 'fas fa-box'} text-purple-500 mr-2 text-lg"></i>
                    <h3 class="font-bold text-gray-200">${cat}</h3>
                </div>
                <div class="space-y-1 text-sm text-gray-300">
                    <div class="flex justify-between"><span>Prod:</span><span>${d.cnt}</span></div>
                    <div class="flex justify-between"><span>Vend:</span><span>${d.vend}</span></div>
                    <div class="flex justify-between"><span>Stock Prom:</span><span>${avg}</span></div>
                </div>`;
                cont.appendChild(card);
            });
        }

        function iniciarSimulacion() {
            if (intervalo) clearInterval(intervalo);
            intervalo = setInterval(avanzarDia, intervaloDuracion);
        }

        function avanzarDia() {
            diaActual++; actualizarDia();

            // Riesgo
            const riesgo = riesgos[Math.floor(Math.random() * riesgos.length)];
            if (riesgo) {
                const rSpan = document.createElement("span");
                rSpan.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-exclamation-triangle text-yellow-400 mr-2"></i>
                    <span class="font-semibold">Día ${diaActual} → ${riesgo.emoji} ${riesgo.efecto.toUpperCase()}</span>
                </div>`;
                riesgosDiv.appendChild(rSpan);

                productos.forEach(p => {
                    if (p.entregaEnDias > 0) {
                        if (riesgo.efecto === "lluvia" || riesgo.efecto === "escasez") {
                            const inc = +(p.costoTransporte * (riesgo.costo - 1)).toFixed(2);
                            p.costoTransporte = +(p.costoTransporte * riesgo.costo).toFixed(2);
                            const det = document.createElement("span");
                            det.className = "text-xs text-orange-300 pl-4";
                            det.innerHTML = `
                            <div class="flex items-center">
                                <i class="fas fa-arrow-up mr-1"></i>
                                <span>${riesgo.emoji} ${p.nombre}: +Bs ${inc} → Bs ${p.costoTransporte.toFixed(2)}</span>
                            </div>`;
                            riesgosDiv.appendChild(det);
                        }
                        if (riesgo.efecto === "bloqueo") {
                            p.entregaEnDias++;
                            const det = document.createElement("span");
                            det.className = "text-xs text-red-400 pl-4";
                            det.innerHTML = `
                            <div class="flex items-center">
                                <i class="fas fa-clock mr-1"></i>
                                <span>🚧 ${p.nombre}: retraso +1d → ${p.entregaEnDias}d</span>
                            </div>`;
                            riesgosDiv.appendChild(det);
                        }
                    }
                });
                riesgosDiv.scrollTop = riesgosDiv.scrollHeight;
            }

            // Ventas y entregas
            productos.forEach(p => {
                if (Math.random() < 0.5 && p.cantidad > 0) {
                    const v = Math.floor(Math.random() * p.cantidad) + 1;
                    p.cantidad -= v; p.ventasTotales += v;
                    const ingreso = v * ((p.costoCompra + p.costoTransporte) * 1.2);
                    ingresos += ingreso;
                    agregarEvento(`
                    <div class="flex items-center">
                        <i class="fas fa-shopping-bag text-green-400 mr-2"></i>
                        <span>${p.nombre} -${v} unidades por ${ingreso.toFixed(2)}Bs</span>
                    </div>`);
                }
                if (p.entregaEnDias > 0) {
                    p.entregaEnDias--;
                    if (p.entregaEnDias === 0) {
                        p.cantidad += p.pedidoCantidad;
                        agregarEvento(`
                        <div class="flex items-center">
                            <i class="fas fa-truck text-blue-400 mr-2"></i>
                            <span>Pedido recibido: ${p.nombre} +${p.pedidoCantidad}unidades.</span>
                        </div>`);
                        p.pedidoCantidad = 0;
                    }
                }
            });

            actualizarTabla(); actualizarMasYMenosVendidos();
            actualizarResumenCategorias(); actualizarFinanzas();
        }

        function realizarPedido(id, cantidad) {
            const p = productos.find(x => x.id === id);
            if (p.entregaEnDias > 0) { alert("Pedido en camino"); return; }
            p.pedidoCantidad = cantidad; p.entregaEnDias = p.tiempoEntrega;
            const cost = cantidad * (p.costoCompra + p.costoTransporte);
            gastos += cost;
            agregarEvento(`
            <div class="flex items-center">
                <i class="fas fa-shopping-cart text-yellow-400 mr-2"></i>
                <span>Pedido ${cantidad} unidades ${p.nombre} Bs ${cost.toFixed(2)} - ${p.tiempoEntrega}d</span>
            </div>`);
            actualizarFinanzas(); actualizarTabla();
        }

        function hacerPedido(id) {
            const val = parseInt(document.getElementById(`input-${id}`).value);
            if (!val || val < 1) { alert("Cantidad inválida"); return; }
            realizarPedido(id, val);
        }
        function hacerPedidoMobile(id) {
            const val = parseInt(document.getElementById(`input-mobile-${id}`).value);
            if (!val || val < 1) { alert("Cantidad inválida"); return; }
            realizarPedido(id, val);
        }

        function ventaManual(id) {
            const p = productos.find(x => x.id === id);
            if (p.cantidad < 1) { alert("Sin stock"); return; }
            p.cantidad--; p.ventasTotales++;
            const venta = (p.costoCompra + p.costoTransporte) * 1.2;
            ingresos += venta;
            agregarEvento(`
            <div class="flex items-center">
                <i class="fas fa-hand-holding-usd text-green-400 mr-2"></i>
                <span>Venta manual ${p.nombre} -1 Bs ${venta.toFixed(2)}</span>
            </div>`);
            actualizarTabla(); actualizarMasYMenosVendidos();
            actualizarResumenCategorias(); actualizarFinanzas();
        }

        function agregarEvento(html) {
            const span = document.createElement("span");
            span.innerHTML = `<div class="flex items-start"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-bold mr-2">Día ${diaActual}</span><div class="flex-1">${html}</div></div>`;
            proceso.appendChild(span); proceso.scrollTop = proceso.scrollHeight;
        }

        function actualizarFinanzas() {
            const capAct = capitalInicial + ingresos - gastos;
            document.getElementById("capitalInicial").textContent = `Bs ${capitalInicial.toFixed(2)}`;
            document.getElementById("gastosTotales").textContent = `Bs ${gastos.toFixed(2)}`;
            document.getElementById("ingresosTotales").textContent = `Bs ${ingresos.toFixed(2)}`;
            const el = document.getElementById("capitalActual");
            el.textContent = `Bs ${capAct.toFixed(2)}`;
            if (capAct < capitalInicial * 0.5) el.className = "text-xl sm:text-2xl font-bold text-red-600 mt-1 pulse-animation";
            else if (capAct > capitalInicial * 1.5) el.className = "text-xl sm:text-2xl font-bold text-green-600 mt-1";
            else el.className = "text-xl sm:text-2xl font-bold text-blue-600 mt-1";
        }

        function actualizarDia() {
            document.getElementById("diaActual").textContent = diaActual;
        }

        function reiniciarDatos() {
            clearInterval(intervalo);
            productos = []; diaActual = 0; capitalInicial = 10000; ingresos = 0; gastos = 0;
            proceso.innerHTML = ""; riesgosDiv.innerHTML = ""; tablaBody.innerHTML = ""; mobileContainer.innerHTML = "";
            document.getElementById("masVendido").innerHTML = "—";
            document.getElementById("menosVendido").innerHTML = "—";
            document.getElementById("resumenCategorias").innerHTML = "";
            actualizarDia(); actualizarTabla(); actualizarFinanzas();
            agregarEvento(`
            <div class="flex items-center">
                <i class="fas fa-refresh text-blue-400 mr-2"></i>
                <span class="font-bold text-blue-600">Sistema reiniciado correctamente</span>
            </div>`);
        }

        function cambiarVelocidad(v) {
            intervaloDuracion = v * 1000;
            document.getElementById("velocidadTexto").textContent = v;
            if (intervalo) { clearInterval(intervalo); iniciarSimulacion(); }
        }

        function iniciarSimulacion() {
            if (intervalo) clearInterval(intervalo);
            intervalo = setInterval(avanzarDia, intervaloDuracion);
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.body.style.opacity = '1';
        });
    </script>


</body>

</html>